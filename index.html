<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aether | Biometric Habit OS</title>
    
    <link rel="manifest" href='data:application/manifest+json,{"name":"Aether OS","short_name":"Aether","start_url":".","display":"standalone","background_color":"#020408","theme_color":"#d4af37"}'>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --accent: #d4af37;
            --emerald: #064e3b;
            --deep-blue: #020617;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text: #f8fafc;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0; padding: 0;
            background: var(--deep-blue);
            color: var(--text);
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* –ñ–∏–≤–æ–π –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –õ–∞–Ω–¥—à–∞—Ñ—Ç */
        #landscape {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 50%, var(--emerald), var(--deep-blue));
            transition: background 2s ease;
            filter: blur(80px);
            opacity: 0.6;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-shell {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding-top: calc(var(--safe-top) + 20px);
            padding-bottom: calc(var(--safe-bottom) + 100px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Premium Header */
        header {
            padding: 0 25px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-oracle {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
            max-width: 70%;
            border-left: 3px solid var(--accent);
            animation: float 4s infinite ease-in-out;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* Habit –°—Ñ–µ—Ä—ã (3D-—ç—Ñ—Ñ–µ–∫—Ç) */
        .world-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 0 20px;
        }

        .habit-sphere {
            aspect-ratio: 1/1;
            background: var(--glass);
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .habit-sphere:active { transform: scale(0.9); }

        /* –Ø–¥—Ä–æ –ø—Ä–∏–≤—ã—á–∫–∏ (–≠–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É—é—â–∏–π –æ—Ä–≥–∞–Ω–∏–∑–º) */
        .core {
            width: 60px; height: 60px;
            background: var(--accent);
            border-radius: 50%;
            filter: blur(15px);
            opacity: 0.4;
            position: absolute;
            transition: 1s ease;
        }

        .growth-stage {
            position: relative;
            z-index: 2;
            font-size: 2.5rem;
            filter: drop-shadow(0 0 10px var(--accent));
            transition: 0.5s;
        }

        .habit-name {
            position: absolute; bottom: 15px;
            font-size: 0.75rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px;
            color: rgba(255,255,255,0.6);
        }

        .completed .core {
            filter: blur(5px);
            opacity: 0.8;
            width: 100px; height: 100px;
            background: #fff;
        }

        .completed .growth-stage { transform: scale(1.2) translateY(-10px); }

        /* –¢–∞–±-–±–∞—Ä –±—É–¥—É—â–µ–≥–æ */
        .nav-dock {
            position: fixed;
            bottom: calc(var(--safe-bottom) + 20px);
            left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            height: 70px;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(25px);
            border-radius: 35px;
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .nav-btn {
            color: rgba(255,255,255,0.3);
            font-size: 1.2rem;
            transition: 0.3s;
            position: relative;
        }

        .nav-btn.active { color: var(--accent); }
        .nav-btn.active::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; border-radius: 50%; background: var(--accent);
        }

        .add-trigger {
            width: 55px; height: 55px;
            background: linear-gradient(135deg, var(--accent), #8a701e);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: #000; font-size: 1.5rem;
            margin-top: -40px;
            box-shadow: 0 10px 20px rgba(212, 175, 55, 0.3);
        }

        /* Modal Ultra */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
            display: none; align-items: center; justify-content: center; z-index: 2000;
            padding: 20px;
        }

        .modal-card {
            background: var(--bg-surface);
            width: 100%; max-width: 400px;
            padding: 40px 30px;
            border-radius: 40px;
            border: 1px solid var(--glass-border);
            text-align: center;
        }

        input {
            width: 100%; background: transparent; border: none;
            border-bottom: 2px solid var(--glass-border);
            color: #fff; font-size: 1.5rem; padding: 10px;
            text-align: center; margin-bottom: 30px;
            font-family: 'Playfair Display', serif;
        }

        .premium-btn {
            background: var(--accent); color: #000;
            padding: 15px 40px; border-radius: 30px;
            font-weight: 700; border: none; cursor: pointer;
        }

        /* –≠–ª–µ–º–µ–Ω—Ç —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –º–∞–≥–∏–∏ */
        .collective-pulse {
            margin: 20px; padding: 20px;
            background: linear-gradient(90deg, rgba(212,175,55,0.05), transparent);
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* –°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="landscape"></div>

    <div class="app-shell" id="app">
        <header>
            <div class="ai-oracle" id="oracle-text">
                –ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–æ—Ä–∏—Ç–º–æ–≤...
            </div>
            <div style="text-align: right;">
                <div style="font-size: 0.6rem; letter-spacing: 2px; opacity: 0.5;">ENERGY</div>
                <div id="energy-val" style="color: var(--accent); font-weight: 700;">80%</div>
            </div>
        </header>

        <div class="collective-pulse">
            <i class="fa-solid fa-users-rays"></i> 
            <span id="social-news">3 –¥—Ä—É–≥–∞ —Å–µ–π—á–∞—Å –≤ —Ñ–æ–∫—É—Å–µ</span>
        </div>

        <div class="world-container" id="habit-grid">
            </div>
    </div>

    <nav class="nav-dock">
        <div class="nav-btn active"><i class="fa-solid fa-compass"></i></div>
        <div class="nav-btn"><i class="fa-solid fa-chart-pie"></i></div>
        <div class="add-trigger" onclick="openCreator()"><i class="fa-solid fa-plus"></i></div>
        <div class="nav-btn"><i class="fa-solid fa-leaf"></i></div>
        <div class="nav-btn"><i class="fa-solid fa-user-ninja"></i></div>
    </nav>

    <div class="modal-overlay" id="modal">
        <div class="modal-card">
            <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 10px;">–ù–æ–≤–æ–µ —Å–µ–º—è</h2>
            <p style="opacity: 0.5; font-size: 0.8rem; margin-bottom: 30px;">–ö–∞–∫—É—é —á–∞—Å—Ç—å –º–∏—Ä–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–∂–∏–≤–∏—Ç—å?</p>
            <input type="text" id="habit-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." autofocus>
            <button class="premium-btn" onclick="createHabit()">–ü—Ä–æ—Ä–∞—Å—Ç–∏—Ç—å</button>
        </div>
    </div>

    <script>
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
        let habits = JSON.parse(localStorage.getItem('aether_data')) || [
            { id: 1, name: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è', stage: 0, done: false, type: 'spirit' },
            { id: 2, name: '–ö–æ–¥–¥–∏–Ω–≥', stage: 2, done: false, type: 'mind' }
        ];

        const stages = ['üå±', 'üåø', 'üå≥', 'üå∏', 'üíé'];
        const oraclePhrases = [
            "–¢–≤–æ–π —Ä–µ–∑–æ–Ω–∞–Ω—Å —Å–µ–≥–æ–¥–Ω—è –Ω–∞ –≤—ã—Å–æ—Ç–µ. –ò–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–æ–∑–∏–¥–∞–Ω–∏—è.",
            "–ë–∏–æ—Ä–∏—Ç–º—ã —Ç—Ä–µ–±—É—é—Ç –ø–æ–∫–æ—è. –ó–∞–≤–µ—Ä—à–∏ –æ–¥–Ω—É –≤–∞–∂–Ω—É—é –∑–∞–¥–∞—á—É.",
            "–≠–Ω–µ—Ä–≥–∏—è –∏–∑—É–º—Ä—É–¥–∞ —Ä–∞—Å—Ç–µ—Ç. –¢–≤–æ–π —Å–∞–¥ –ø—Ä–∏–≤—ã—á–µ–∫ –∂–¥–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è.",
            "–ó–≤–µ–∑–¥—ã —Å–æ–≤–µ—Ç—É—é—Ç —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ç–µ–ª–µ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 2 —á–∞—Å–∞."
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            renderHabits();
            updateOracle();
            updateBackground();
            
            // PWA iOS fix –¥–ª—è –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞
            document.addEventListener('touchstart', () => {}, {passive: true});
        }

        function renderHabits() {
            const grid = document.getElementById('habit-grid');
            grid.innerHTML = '';

            habits.forEach(h => {
                const div = document.createElement('div');
                div.className = `habit-sphere ${h.done ? 'completed' : ''}`;
                div.onclick = () => toggleHabit(h.id);
                
                div.innerHTML = `
                    <div class="core" style="background: ${getCoreColor(h.type)}"></div>
                    <div class="growth-stage">${stages[h.stage]}</div>
                    <div class="habit-name">${h.name}</div>
                `;
                grid.appendChild(div);
            });
            
            updateEnergy();
        }

        function toggleHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit.done) {
                habit.done = true;
                habit.stage = Math.min(habit.stage + 1, 4);
                triggerSuccessEffect();
            } else {
                habit.done = false;
            }
            save();
            renderHabits();
        }

        function createHabit() {
            const name = document.getElementById('habit-name').value;
            if (!name) return;
            
            habits.push({
                id: Date.now(),
                name: name,
                stage: 0,
                done: false,
                type: 'mind'
            });
            
            document.getElementById('habit-name').value = '';
            closeCreator();
            save();
            renderHabits();
        }

        function getCoreColor(type) {
            const colors = { spirit: '#d4af37', mind: '#60a5fa', body: '#10b981' };
            return colors[type] || '#d4af37';
        }

        function updateOracle() {
            const text = oraclePhrases[Math.floor(Math.random() * oraclePhrases.length)];
            document.getElementById('oracle-text').innerText = text;
        }

        function updateEnergy() {
            const done = habits.filter(h => h.done).length;
            const total = habits.length;
            const energy = total ? Math.round((done / total) * 100) : 0;
            document.getElementById('energy-val').innerText = `${energy}%`;
            
            // –ú–µ–Ω—è–µ–º —Ñ–æ–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —ç–Ω–µ—Ä–≥–∏–∏
            const landscape = document.getElementById('landscape');
            if (energy > 70) {
                landscape.style.background = 'radial-gradient(circle at 50% 50%, #064e3b, #020617)';
            } else if (energy < 30) {
                landscape.style.background = 'radial-gradient(circle at 50% 50%, #450a0a, #020617)';
            }
        }

        function triggerSuccessEffect() {
            if (navigator.vibrate) navigator.vibrate([10, 30, 10]);
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å JS Confetti
        }

        function openCreator() { document.getElementById('modal').style.display = 'flex'; }
        function closeCreator() { document.getElementById('modal').style.display = 'none'; }

        function save() {
            localStorage.setItem('aether_data', JSON.stringify(habits));
        }

        function updateBackground() {
            // –ü–ª–∞–≤–Ω–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞
            let angle = 0;
            setInterval(() => {
                angle += 0.01;
                const op = 0.5 + Math.sin(angle) * 0.1;
                document.getElementById('landscape').style.opacity = op;
            }, 50);
        }

        // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Oracle —Ä–∞–∑ –≤ 30 —Å–µ–∫
        setInterval(updateOracle, 30000);

        init();
    </script>
</body>
</html>
